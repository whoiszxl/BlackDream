## ebay去中心化拍卖平台竞标和公告测试

1. 进入项目的目录下，执行`truffle develop`进入测试控制台
2. 编译：`compile`,发布：`migrate --reset`
3. 获取到1ther的wei值：`amt_1 = web3.utils.toWei('1', 'ether');`
4. 拿到当前时间：`current_time = Math.round(new Date() / 1000);`
5. 获取到合约对象：`var contract; EcommerceStore.deployed().then(function(instance) {contract = instance;});`
6. 调用添加函数添加商品到链上：`contract.addProductToStore('iphoneXR 128G红色', 'Phone', 'imageLink', 'descLink', current_time, current_time+100000, amt_1, 0).then(function(f) {console.log(f);});`
7. 调用获取函数获取链上的商品：`contract.getProduct(1).then(function(f) {console.log(f);});`
8. 获取到ethereumjs-util工具，安装方法：`npm install --save-dev ethereumjs-util@5.1.2`，truffle控制台导入方法：`eutil = require('./app/node_modules/ethereumjs-util');`
9. 获取到A用户竞标的**真实价格+秘钥加密后的值**, 代码：`sealedBid = '0x' + eutil.sha3((2*amt_1) + 'secretkey1').toString('hex');`
10. A用户开始对商品序号为1的商品开始竞标：`contract.bid(1, sealedBid, {value: 3*amt_1,from:'0x73Bb6B55F4a946cE2E6F9D2f14eb99d95E63761C'}).then(function(f) {console.log(f);});`
11. 提示: 如何拿到truffle中的账号：`web3.eth.personal.getAccounts()`
12. 获取到B用户竞标的**真实价格+秘钥加密后的值**, 代码：`sealedBid = '0x' + eutil.sha3((3*amt_1) + 'secretkey2').toString('hex');`
13. B用户开始对商品序号为1的商品开始竞标：`contract.bid(1, sealedBid, {value: 4*amt_1,from:'0x150E81808f15bE8527a7d3B4A0bAaff63e07A637'}).then(function(f) {console.log(f);});`
14. A用户进行公告：`contract.revealBid(1, (2*amt_1).toString(), 'secretkey1', {from: '0x73Bb6B55F4a946cE2E6F9D2f14eb99d95E63761C'}).then(function(f) {console.log(f);});`
15. B用户进行公告：`contract.revealBid(1, (2*amt_1).toString(), 'secretkey2', {from: '0x150E81808f15bE8527a7d3B4A0bAaff63e07A637'}).then(function(f) {console.log(f);});`
16. 获取到最高竞拍者的信息：`contract.highestBidderInfo.call(1).then(function(f) {console.log(f);});`